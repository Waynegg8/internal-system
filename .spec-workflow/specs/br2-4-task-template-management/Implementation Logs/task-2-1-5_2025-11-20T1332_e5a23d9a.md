# Implementation Log: Task 2.1.5

**Summary:** 创建了 updateTaskTemplate 函数，用于调用 PUT /api/v2/task-templates/:id 端点。函数支持更新所有模板字段（除了服务）：template_name、client_id、description、sop_id、is_active、tasks/stages（任务配置列表）、默认规则配置等。不包含 service_id 字段，符合需求要求（服务不可修改）。请求体格式化正确，只包含提供的字段。包含完整的错误处理：验证模板 ID、捕获并记录错误、保留 422 验证错误的原始错误信息、其他错误重新抛出。遵循现有 API 模式（与 updateTask 等函数一致）。

**Timestamp:** 2025-11-20T13:32:04.415Z
**Log ID:** e5a23d9a-75ae-4e5e-96e6-1c0d2bad742e

---

## Statistics

- **Lines Added:** +95
- **Lines Removed:** -0
- **Files Changed:** 1
- **Net Change:** 95

## Files Modified
- src/api/task-templates.js

## Files Created
_No files created_

---

## Artifacts

### API Endpoints

#### PUT /api/v2/task-templates/:id
- **Purpose:** 更新任务模板，支持更新所有字段（除了服务）
- **Location:** src/api/task-templates.js:133
- **Request Format:** Path parameter: id (number|string) - 模板ID | Request body: { template_name?: string, client_id?: number|null, description?: string, sop_id?: number, is_active?: boolean, tasks?: Array, stages?: Array, default_due_date_rule?: string, default_due_date_value?: string|number, default_due_date_offset_days?: number, default_advance_days?: number }
- **Response Format:** Success: { success: true, data: { template_id: number }, message: string, request_id: string } | Error (422): { success: false, error: "VALIDATION_ERROR", message: string, data: object|null, request_id: string } | Error (404): { success: false, error: "NOT_FOUND", message: string, request_id: string } | Error (500): { success: false, error: "DB_ERROR", message: string, request_id: string }

### Functions

#### updateTaskTemplate
- **Purpose:** 更新任务模板，支持更新所有字段（除了服务）
- **Location:** src/api/task-templates.js:133
- **Signature:** async function updateTaskTemplate(templateId, payload)
- **Exported:** Yes

