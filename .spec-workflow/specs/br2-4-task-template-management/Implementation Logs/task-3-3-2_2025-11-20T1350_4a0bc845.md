# Implementation Log: Task 3.3.2

**Summary:** 在 TaskTemplateFormNew.vue 中添加了统一模板唯一性验证。创建了 validateUnifiedTemplateUniqueness 异步验证函数，当选择服务且未选择客户（统一模板）时，检查该服务是否已存在统一模板。使用 fetchTaskTemplates API 查询该服务的统一模板列表，编辑模式下排除当前模板。如果已存在统一模板，返回清晰的错误消息（包含已存在模板的名称）。验证规则添加到 service_id 和 client_id 字段，在 change 和 blur 事件时触发。当服务或客户变更时，自动触发验证。

**Timestamp:** 2025-11-20T13:50:50.941Z
**Log ID:** 4a0bc845-7831-4ea1-8045-b8b523de1172

---

## Statistics

- **Lines Added:** +60
- **Lines Removed:** -5
- **Files Changed:** 1
- **Net Change:** 55

## Files Modified
- src/components/settings/TaskTemplateFormNew.vue

## Files Created
_No files created_

---

## Artifacts

### Components

#### TaskTemplateFormNew
- **Type:** Vue
- **Purpose:** 任务模板创建/编辑表单，包含统一模板唯一性验证
- **Location:** src/components/settings/TaskTemplateFormNew.vue
- **Props:** visible, editingTemplate, services, clients, serviceSops, loading
- **Exports:** TaskTemplateFormNew (default)

### Functions

#### validateUnifiedTemplateUniqueness
- **Purpose:** 检查统一模板唯一性（异步验证），确保每个服务只能有一个统一模板
- **Location:** src/components/settings/TaskTemplateFormNew.vue:205
- **Signature:** async (rule, value) => Promise<void>
- **Exported:** No

#### handleClientChange
- **Purpose:** 处理客户变更，触发统一模板唯一性验证
- **Location:** src/components/settings/TaskTemplateFormNew.vue:295
- **Signature:** () => void
- **Exported:** No

