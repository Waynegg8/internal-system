# Implementation Log: Task 2.1.4

**Summary:** 创建了 createTaskTemplate 函数，用于调用 POST /api/v2/task-templates 端点。函数支持创建统一模板（client_id 为 null）和客户专属模板（client_id 为具体值）。处理所有必需的字段：template_name（必填）、service_id（必填）、client_id（可选）、description（可选）、sop_id（可选）、tasks/stages（任务配置列表）、默认规则配置等。请求体格式化正确，只包含提供的字段。包含完整的错误处理：捕获并记录错误，保留 422 验证错误的原始错误信息，其他错误重新抛出。遵循现有 API 模式（与 createTask 等函数一致）。

**Timestamp:** 2025-11-20T13:29:48.749Z
**Log ID:** e5725745-2783-44e8-92a3-c31838586594

---

## Statistics

- **Lines Added:** +90
- **Lines Removed:** -0
- **Files Changed:** 1
- **Net Change:** 90

## Files Modified
- src/api/task-templates.js

## Files Created
_No files created_

---

## Artifacts

### API Endpoints

#### POST /api/v2/task-templates
- **Purpose:** 创建任务模板
- **Location:** src/api/task-templates.js:47
- **Request Format:** Request body: { template_name: string, service_id: number, client_id?: number|null, description?: string, sop_id?: number, tasks?: Array, stages?: Array, default_due_date_rule?: string, default_due_date_value?: string|number, default_due_date_offset_days?: number, default_advance_days?: number }
- **Response Format:** Success: { success: true, data: { template_id: number }, message: string, request_id: string } | Error (422): { success: false, error: "VALIDATION_ERROR", message: string, data: Array<{field, message}>, request_id: string } | Error (500): { success: false, error: "DB_ERROR", message: string, request_id: string }

### Functions

#### createTaskTemplate
- **Purpose:** 创建任务模板，支持统一模板和客户专属模板
- **Location:** src/api/task-templates.js:47
- **Signature:** async function createTaskTemplate(payload)
- **Exported:** Yes

