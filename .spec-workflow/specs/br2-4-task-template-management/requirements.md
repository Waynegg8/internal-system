# Requirements Document: BR2.4: 任務模板管理

## Introduction

任務模板管理功能在設定頁面提供任務模板的創建、編輯、刪除和管理界面，幫助員工為不同服務創建可重用的任務配置模板。所有員工都可以管理任務模板（除了用戶管理外，所有設定員工都有權限）。

**User Story**: 作為會計師事務所的員工，我需要在設定頁面管理任務模板，以便為不同服務創建可重用的任務配置模板。

## Alignment with Product Vision

本功能支持任務管理系統的核心目標：
- **提升配置效率**：集中管理任務模板，提升任務配置效率
- **滿足個性化需求**：支援客戶專屬模板，滿足不同客戶的個性化需求
- **減少重複工作**：模板可套用到服務設定，減少重複配置工作
- **確保階段清晰**：階段命名和順序管理，確保任務階段清晰明確

## Requirements

### BR2.4.1: 任務模板列表

**User Story**: 作為員工，我需要查看任務模板列表，以便管理所有任務模板。

**驗收標準**:
- WHEN 員工打開任務模板管理頁面時 THEN 系統 SHALL 顯示所有任務模板列表
- WHEN 系統顯示任務模板列表時 THEN 系統 SHALL 顯示以下資訊：
  - 模板名稱
  - 服務（服務名稱）
  - 客戶（統一模板或客戶名稱）
  - 任務數量
  - 創建時間
  - 操作（編輯、刪除）
- WHEN 員工搜尋任務模板時 THEN 系統 SHALL 支援按模板名稱、服務、客戶搜尋
- WHEN 員工篩選任務模板時 THEN 系統 SHALL 支援按服務、客戶類型（統一模板/客戶專屬）篩選

### BR2.4.2: 任務模板創建

**User Story**: 作為員工，我需要創建任務模板，以便為服務建立可重用的任務配置。

**驗收標準**:
- WHEN 員工點擊「新增任務模板」按鈕時 THEN 系統 SHALL 打開任務模板創建表單
- WHEN 員工創建任務模板時 THEN 系統 SHALL 要求填寫以下資訊：
  - 模板名稱（必填）
  - 服務（必填，從服務列表選擇）
  - 客戶（可選，如果未選擇則為統一模板）
  - 模板描述（可選）
  - 任務配置列表（至少一個任務）
- WHEN 員工添加任務配置時 THEN 系統 SHALL 使用與任務創建相同的配置界面
- WHEN 員工保存任務模板時 THEN 系統 SHALL 驗證模板名稱和服務的唯一性（同一服務下，統一模板只能有一個，客戶專屬模板可以有多個）

### BR2.4.3: 任務模板編輯

**User Story**: 作為員工，我需要編輯任務模板，以便更新模板配置。

**驗收標準**:
- WHEN 員工點擊「編輯」按鈕時 THEN 系統 SHALL 打開任務模板編輯表單
- WHEN 員工編輯任務模板時 THEN 系統 SHALL 允許修改所有欄位（除了服務）
- WHEN 員工修改任務配置時 THEN 系統 SHALL 使用與任務創建相同的配置界面
- WHEN 員工保存任務模板時 THEN 系統 SHALL 更新模板並同步到已使用該模板的服務設定（如果適用）

### BR2.4.4: 任務模板刪除

**User Story**: 作為員工，我需要刪除任務模板，以便清理不需要的模板。

**驗收標準**:
- WHEN 員工點擊「刪除」按鈕時 THEN 系統 SHALL 要求確認刪除
- WHEN 員工確認刪除時 THEN 系統 SHALL 檢查模板是否被使用
- WHEN 模板被使用時 THEN 系統 SHALL 提示無法刪除，並顯示使用該模板的服務列表
- WHEN 模板未被使用時 THEN 系統 SHALL 刪除模板並顯示成功提示

### BR2.4.5: 階段命名和順序管理

**User Story**: 作為員工，我需要管理任務階段的名稱和順序，以便確保任務階段清晰明確。

**驗收標準**:
- WHEN 員工在設定頁面管理階段時 THEN 系統 SHALL 允許為階段命名（不只是「階段1、階段2」）
- WHEN 員工設定階段順序時 THEN 系統 SHALL 允許調整階段順序
- WHEN 員工修改階段名稱或順序時 THEN 系統 SHALL 同步更新到：
  - 任務模板中的階段配置
  - 客戶服務中的任務配置
- WHEN 系統同步階段變更時 THEN 系統 SHALL 在確認後才執行同步

### BR2.4.6: 任務模板套用

**User Story**: 作為員工，我需要在服務設定中套用任務模板，以便快速配置任務。

**驗收標準**:
- WHEN 員工在服務設定中配置任務時 THEN 系統 SHALL 允許選擇任務模板
- WHEN 員工選擇任務模板時 THEN 系統 SHALL 優先顯示客戶專屬模板，其次顯示統一模板
- WHEN 員工套用任務模板時 THEN 系統 SHALL 自動填充任務配置
- WHEN 員工套用任務模板後 THEN 系統 SHALL 允許修改任務配置，修改不會影響原始模板

---

## 業務規則

### 任務模板分類規則

- 任務模板分為兩類：
  - **統一模板**：未指定客戶的模板，適用於所有客戶
  - **客戶專屬模板**：指定客戶的模板，僅適用於該客戶
- 同一服務下，統一模板只能有一個
- 同一服務下，客戶專屬模板可以有多個（不同客戶）

### 任務模板優先級規則

- 套用任務模板時，優先使用客戶專屬模板
- 如果沒有客戶專屬模板，則使用統一模板
- 如果客戶有多個專屬模板，全部顯示，員工可選擇

### 階段管理規則

- 階段名稱可在設定頁面管理（不只是「階段1、階段2」）
- 階段順序可在設定頁面調整
- 階段變更會同步到：
  - 任務模板中的階段配置
  - 客戶服務中的任務配置
- 階段同步需要確認後才執行

### 任務模板使用規則

- 任務模板套用後，可以修改任務配置
- 修改任務配置不會影響原始模板
- 任務模板刪除前需檢查是否被使用

---

## 非功能性需求

### Code Architecture and Modularity
- **Single Responsibility Principle**: Each file should have a single, well-defined purpose
- **Modular Design**: Components, utilities, and services should be isolated and reusable
- **Dependency Management**: Minimize interdependencies between modules
- **Clear Interfaces**: Define clean contracts between components and layers

### 性能要求

- 任務模板列表載入時間 < 2 秒
- 任務模板保存響應時間 < 1 秒
- 階段同步響應時間 < 3 秒

### Security

- 所有輸入資料應進行驗證和清理，防止 SQL 注入和 XSS 攻擊
- 任務模板資料的存取應遵循權限控制機制
- 模板刪除前應驗證使用情況，防止誤刪
- 敏感資訊應在傳輸和存儲時進行適當保護

### 可用性要求

- 任務模板管理界面清晰易懂
- 階段命名和順序管理操作直觀
- 任務模板套用流程簡單

### 可靠性要求

- 任務模板刪除前驗證使用情況
- 階段同步失敗時有明確錯誤提示
- 任務模板配置驗證完整

