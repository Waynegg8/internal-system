# Requirements Document: BR11.2: 資源上傳

## Introduction

資源上傳功能提供統一的資源上傳界面，支援單個和多個文件同時上傳、拖拽上傳、進度顯示等功能。

**User Story**: 作為會計師事務所的員工，我需要上傳資源文件到系統中，以便能夠管理和分享這些資源。

## Alignment with Product Vision

本功能支持資源管理系統的核心目標：
- **提升上傳效率**: 支援多文件上傳，減少操作次數
- **改善用戶體驗**: 拖拽上傳、進度顯示等功能提升用戶體驗
- **確保數據質量**: 表單驗證確保資源信息完整準確

## Requirements

### BR11.2.1: 單文件上傳

**User Story**: 作為員工，我需要上傳單個資源文件，以便將文件添加到系統中。

#### 驗收標準
- WHEN 員工選擇單個文件時 THEN 系統 SHALL 允許選擇文件
- WHEN 員工上傳文件時 THEN 系統 SHALL 驗證文件類型和大小
- WHEN 文件類型不符合要求時 THEN 系統 SHALL 顯示錯誤提示並阻止上傳
- WHEN 文件大小超過 25MB 時 THEN 系統 SHALL 顯示錯誤提示並阻止上傳

### BR11.2.2: 多文件上傳

**User Story**: 作為員工，我需要同時上傳多個文件，以便提升上傳效率。

#### 驗收標準
- WHEN 員工選擇多個文件時 THEN 系統 SHALL 允許同時選擇多個文件
- WHEN 員工上傳多個文件時 THEN 系統 SHALL 同時處理多個文件上傳
- WHEN 上傳多個文件時 THEN 系統 SHALL 為每個文件顯示獨立的進度條
- WHEN 某個文件上傳失敗時 THEN 系統 SHALL 不影響其他文件的上傳

### BR11.2.3: 拖拽上傳

**User Story**: 作為員工，我需要通過拖拽方式上傳文件，以便快速上傳文件。

#### 驗收標準
- WHEN 員工拖拽文件到上傳區域時 THEN 系統 SHALL 接受文件並準備上傳
- WHEN 員工拖拽多個文件時 THEN 系統 SHALL 接受所有文件
- WHEN 拖拽的文件不符合要求時 THEN 系統 SHALL 顯示錯誤提示

### BR11.2.4: 文件驗證

**User Story**: 作為員工，我需要確保上傳的文件符合要求，以便避免上傳錯誤。

#### 驗收標準
- WHEN 員工選擇文件時 THEN 系統 SHALL 驗證文件類型（PDF、Word、Excel、PowerPoint、圖片等）
- WHEN 員工選擇文件時 THEN 系統 SHALL 驗證文件大小（最大 25MB）
- WHEN 文件不符合要求時 THEN 系統 SHALL 顯示具體的錯誤信息

### BR11.2.5: 上傳進度顯示

**User Story**: 作為員工，我需要查看上傳進度，以便了解上傳狀態。

#### 驗收標準
- WHEN 員工上傳文件時 THEN 系統 SHALL 顯示上傳進度條
- WHEN 上傳多個文件時 THEN 系統 SHALL 為每個文件顯示獨立的進度條
- WHEN 上傳完成時 THEN 系統 SHALL 顯示成功提示
- WHEN 上傳失敗時 THEN 系統 SHALL 顯示錯誤提示

### BR11.2.6: 表單填寫

**User Story**: 作為員工，我需要填寫資源元數據，以便資源能夠被正確分類和搜尋。

#### 驗收標準
- WHEN 員工上傳文件時 THEN 系統 SHALL 要求填寫必填欄位：標題、服務類型、適用層級
- WHEN 員工上傳文件時 THEN 系統 SHALL 允許填寫可選欄位：客戶、年份、月份、標籤、描述
- WHEN 員工未填寫必填欄位時 THEN 系統 SHALL 阻止上傳並顯示錯誤提示

### BR11.2.7: 上傳後行為

**User Story**: 作為員工，我需要在上傳成功後看到新資源，以便確認上傳成功。

#### 驗收標準
- WHEN 上傳成功時 THEN 系統 SHALL 新資源顯示在列表頂部
- WHEN 上傳成功時 THEN 系統 SHALL 不自動選中新資源（允許繼續上傳）
- WHEN 上傳成功時 THEN 系統 SHALL 關閉上傳抽屜或重置表單

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 上傳組件應該有單一、明確的職責
- **Modular Design**: 上傳邏輯應該與表單邏輯分離，組件、工具和服務應該隔離且可重用
- **Dependency Management**: 最小化模組間的相互依賴
- **Clear Interfaces**: 定義組件和層級之間的清晰契約
- **Reusability**: 上傳組件應該可以在多處重用

### Performance
- 單個文件上傳響應時間 < 5 秒（25MB 以內文件）
- 多文件上傳支援並發處理（瀏覽器並發限制內）
- 進度更新頻率適中（每 100ms 更新一次，不影響性能）
- 文件驗證響應時間 < 100ms（前端驗證）

### Security
- 文件類型驗證（前端和後端雙重驗證）
  - 允許類型：PDF、Word (.doc, .docx)、Excel (.xls, .xlsx)、PowerPoint (.ppt, .pptx)、圖片 (.jpg, .jpeg, .png, .gif)
  - 後端驗證文件 MIME 類型和文件擴展名
- 文件大小限制（前端和後端雙重限制）
  - 最大文件大小：25MB
  - 前端驗證提供即時反饋，後端驗證確保安全性
- 使用參數化查詢防止 SQL 注入
- 文件路徑安全：使用 UUID 生成唯一文件名，防止路徑遍歷攻擊
- 認證授權：只有登入用戶才能上傳文件

### Reliability
- 上傳失敗時提供重試機制（單個文件可重試，不影響其他文件）
- 網絡中斷時能夠恢復上傳（未來增強，當前版本需要重新上傳）
- 錯誤處理完善：捕獲並顯示具體錯誤信息（網絡錯誤、服務器錯誤、驗證錯誤等）
- 部分成功處理：多文件上傳時，部分文件失敗不影響已成功的文件
- 事務一致性：文件上傳到 R2 和元數據保存到 D1 應該保持一致性（失敗時清理已上傳文件）

### Usability
- 界面簡潔直觀：上傳區域明顯，操作流程清晰
- 拖拽上傳體驗流暢：拖拽時有視覺反饋，拖拽區域明確
- 進度顯示清晰：每個文件獨立進度條，顯示百分比和狀態（上傳中/成功/失敗）
- 錯誤提示明確：錯誤信息具體可操作（如「文件大小超過 25MB，請選擇較小的文件」）
- 表單驗證即時反饋：必填欄位未填寫時立即提示
- 上傳成功後明確反饋：顯示成功提示，新資源出現在列表頂部

