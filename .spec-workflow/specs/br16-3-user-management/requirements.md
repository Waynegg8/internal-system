# Requirements Document: BR16.3: 使用者管理

## Introduction

使用者管理功能提供系統層級的使用者管理，包括新增、編輯、刪除使用者，查看和重置使用者密碼，以及員工個人資料編輯。本功能幫助管理員統一管理系統使用者，為系統權限控制提供基礎。

**User Story**: 作為系統管理員，我需要管理系統使用者，以便能夠統一管理系統使用者，為系統權限控制提供基礎。

## Alignment with Product Vision

本功能支持系統設定的核心目標：
- **統一使用者管理**：集中管理所有系統使用者，確保使用者資料的一致性
- **權限控制**：為系統權限控制提供基礎
- **個人資料管理**：支援員工編輯個人資料

## Requirements

### BR16.3.1: 使用者列表展示

**User Story**: 作為管理員，我需要查看使用者列表，以便了解所有使用者的狀況。

#### 驗收標準
- WHEN 管理員打開使用者管理頁面時 THEN 系統 SHALL 顯示所有使用者（僅管理員可訪問）
- WHEN 管理員查看使用者列表時 THEN 系統 SHALL 顯示以下資訊：
  - ID（`user_id`）
  - 姓名（`name`）
  - 帳號（`username`）
  - 角色（`is_admin`：管理員/員工）
  - 操作（編輯、查看密碼、重置密碼、刪除）
- WHEN 管理員查看使用者列表時 THEN 系統 SHALL 支援列表排序和搜尋功能（如果實作）
- WHEN 管理員查看使用者列表失敗時 THEN 系統 SHALL 顯示錯誤提示

### BR16.3.2: 新增使用者

**User Story**: 作為管理員，我需要新增使用者，以便擴展系統使用者。

#### 驗收標準
- WHEN 管理員點擊「新增用戶」按鈕時 THEN 系統 SHALL 顯示使用者表單（彈窗或表單區域）
- WHEN 管理員填寫使用者表單時 THEN 系統 SHALL 要求填寫以下欄位：
  - 姓名（必填）：最多 100 個字符
  - 帳號（必填）：最多 50 個字符，且必須唯一
  - 密碼（必填，僅新增時）：至少 6 個字符
  - 性別（必填）：男性/女性選項
  - 到職日（必填）：日期選擇器
  - 角色（必填）：管理員/員工選項
- WHEN 管理員提交新增表單時 THEN 系統 SHALL 驗證必填欄位和欄位格式
- WHEN 管理員提交新增表單時 THEN 系統 SHALL 檢查帳號是否已存在，如果存在則顯示錯誤提示
- WHEN 管理員成功新增使用者時 THEN 系統 SHALL 同時保存 `password`（加密）和 `plain_password`（明文）欄位
- WHEN 管理員成功新增使用者時 THEN 系統 SHALL 刷新使用者列表並顯示成功提示
- WHEN 管理員新增使用者失敗時 THEN 系統 SHALL 顯示錯誤提示並保持表單狀態

### BR16.3.3: 編輯使用者

**User Story**: 作為管理員，我需要編輯使用者資訊，以便更新使用者資料。

#### 驗收標準
- WHEN 管理員點擊「編輯」按鈕時 THEN 系統 SHALL 顯示使用者編輯表單（彈窗或表單區域），並預填充現有資料
- WHEN 管理員編輯使用者時 THEN 系統 SHALL 允許修改以下欄位：
  - 姓名（必填）：最多 100 個字符
  - 帳號（必填）：最多 50 個字符，且必須唯一（排除當前使用者）
  - 性別（必填）：男性/女性選項
  - 到職日（必填）：日期選擇器
  - 角色（必填）：管理員/員工選項
- WHEN 管理員編輯使用者時 THEN 系統 SHALL 不顯示密碼欄位（密碼需通過重置密碼功能修改）
- WHEN 管理員提交編輯表單時 THEN 系統 SHALL 驗證必填欄位和欄位格式
- WHEN 管理員提交編輯表單時 THEN 系統 SHALL 檢查帳號是否已被其他使用者使用，如果存在則顯示錯誤提示
- WHEN 管理員成功更新使用者時 THEN 系統 SHALL 刷新使用者列表並顯示成功提示
- WHEN 管理員更新使用者失敗時 THEN 系統 SHALL 顯示錯誤提示並保持表單狀態

### BR16.3.4: 刪除使用者

**User Story**: 作為管理員，我需要刪除使用者，以便移除不再使用的使用者帳號。

#### 驗收標準
- WHEN 管理員點擊「刪除」按鈕時 THEN 系統 SHALL 顯示確認對話框，詢問是否確定刪除
- WHEN 管理員確認刪除時 THEN 系統 SHALL 從資料庫真正刪除該使用者（硬刪除，使用 DELETE FROM，非軟刪除）
- WHEN 管理員刪除使用者時 THEN 系統 SHALL 不檢查關聯資料（不檢查是否有任務、工時記錄等）
- WHEN 管理員取消刪除時 THEN 系統 SHALL 關閉確認對話框，不執行任何操作
- WHEN 管理員成功刪除使用者時 THEN 系統 SHALL 刷新使用者列表並顯示成功提示
- WHEN 管理員刪除使用者失敗時 THEN 系統 SHALL 顯示錯誤提示，使用者仍存在於列表中

### BR16.3.5: 查看使用者密碼

**User Story**: 作為管理員，我需要查看使用者密碼，以便協助使用者找回密碼。

#### 驗收標準
- WHEN 管理員點擊「查看密碼」按鈕時 THEN 系統 SHALL 顯示密碼查看彈窗
- WHEN 管理員查看密碼時 THEN 系統 SHALL 顯示使用者的明文密碼（如果存在，從 `plain_password` 欄位讀取）
- WHEN 使用者沒有密碼記錄時 THEN 系統 SHALL 顯示提示訊息（例如：「此使用者尚未設定密碼」）
- WHEN 管理員查看密碼時 THEN 系統 SHALL 僅顯示密碼，不允許編輯
- WHEN 管理員關閉密碼查看彈窗時 THEN 系統 SHALL 關閉彈窗，不執行任何操作

### BR16.3.6: 重置使用者密碼

**User Story**: 作為管理員，我需要重置使用者密碼，以便協助使用者重置密碼。

#### 驗收標準
- WHEN 管理員點擊「重置密碼」按鈕時 THEN 系統 SHALL 顯示密碼重置彈窗
- WHEN 管理員重置密碼時 THEN 系統 SHALL 要求輸入新密碼（至少 6 個字符）
- WHEN 管理員提交重置密碼時 THEN 系統 SHALL 驗證密碼長度
- WHEN 管理員成功重置密碼時 THEN 系統 SHALL 同時更新 `password`（加密）和 `plain_password`（明文）欄位
- WHEN 管理員成功重置密碼時 THEN 系統 SHALL 顯示成功提示並關閉彈窗
- WHEN 管理員重置密碼失敗時 THEN 系統 SHALL 顯示錯誤提示並保持彈窗狀態

### BR16.3.7: 員工個人資料編輯

**User Story**: 作為員工，我需要編輯個人資料，以便更新我的個人資訊。

#### 驗收標準
- WHEN 員工（非管理員）打開使用者管理頁面時 THEN 系統 SHALL 顯示個人資料編輯界面（而非使用者列表）
- WHEN 員工編輯個人資料時 THEN 系統 SHALL 允許編輯以下欄位：
  - 到職日（必填）：日期選擇器
  - 性別（可選）：男性/女性選項
- WHEN 員工編輯個人資料時 THEN 系統 SHALL 不提供電子郵件欄位
- WHEN 員工編輯個人資料時 THEN 系統 SHALL 顯示姓名和帳號為唯讀（不可編輯）
- WHEN 員工編輯個人資料時 THEN 系統 SHALL 預填充現有的到職日和性別資料
- WHEN 員工提交個人資料更新時 THEN 系統 SHALL 驗證必填欄位（到職日）
- WHEN 員工成功更新個人資料時 THEN 系統 SHALL 顯示成功提示並更新當前使用者資訊
- WHEN 員工更新個人資料失敗時 THEN 系統 SHALL 顯示錯誤提示並保持表單狀態

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 每個文件應該有單一、明確的職責
- **Modular Design**: 組件、工具和服務應該隔離且可重用
- **Dependency Management**: 最小化模組之間的相互依賴
- **Clear Interfaces**: 定義組件和層之間的清晰契約

### Performance
- API 響應時間 < 500ms
- 頁面載入時間 < 2 秒
- 表單提交響應時間 < 1 秒

### Security
- 僅管理員可訪問使用者管理頁面（查看使用者列表）
- 員工只能編輯自己的個人資料
- 使用參數化查詢防止 SQL 注入
- 前端輸入驗證和後端驗證
- 密碼存儲使用適當的加密方式

### Reliability
- 使用者列表載入穩定
- 新增/編輯/刪除操作可靠
- 密碼重置功能穩定

### Usability
- 界面簡潔直觀
- 管理員和員工界面清晰區分
- 表單驗證提示清晰


