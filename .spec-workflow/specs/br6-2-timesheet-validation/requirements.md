# Requirements Document: BR6.2: 工時規則校驗

## Introduction

工時規則校驗功能提供完整的工時填寫規則驗證，確保工時記錄符合勞基法規定和業務規則。本功能支援日期類型與工時類型一致性驗證、正常工時規則驗證、加班前置條件驗證等。

**User Story**: 作為會計師事務所的員工，我需要系統自動驗證工時填寫規則，以便確保工時記錄符合勞基法規定和業務規則。

## Alignment with Product Vision

本功能支持工時記錄系統的核心目標：
- **符合勞基法規定**：確保工時記錄符合勞基法關於正常工時、加班的規定
- **數據準確性**：通過規則驗證確保工時記錄的準確性
- **用戶體驗**：即時驗證提供即時反饋，減少錯誤提交

## Requirements

### BR6.2.1: 日期類型與工時類型一致性驗證

**User Story**: 作為員工，我需要系統驗證日期類型與工時類型的一致性，以便確保工時記錄正確。

#### 驗收標準
- WHEN 員工選擇工時類型時 THEN 系統 SHALL 根據日期類型過濾可用的工時類型
- WHEN 日期為工作日時 THEN 系統 SHALL 只允許使用「一般」、「平日OT前2h」、「平日OT後2h」
- WHEN 日期為休息日（週六）時 THEN 系統 SHALL 只允許使用「休息日前2h」、「休息日3-8h」、「休息日9-12h」
- WHEN 日期為例假日（週日）時 THEN 系統 SHALL 只允許使用「例假8h內」、「例假9-12h」
- WHEN 日期為國定假日時 THEN 系統 SHALL 只允許使用「國定8h內」、「國定9-10h」、「國定11-12h」
- WHEN 員工選擇不符合日期類型的工時類型時 THEN 系統 SHALL 提示錯誤並阻止提交

### BR6.2.2: 工作日正常工時規則驗證

**User Story**: 作為員工，我需要系統驗證工作日正常工時規則，以便確保正常工時不超過 8 小時。

#### 驗收標準
- WHEN 員工填寫正常工時時 THEN 系統 SHALL 驗證正常工時 + 請假時數 <= 8 小時
- WHEN 正常工時 + 請假時數 > 8 小時時 THEN 系統 SHALL 提示錯誤並阻止提交
- WHEN 當天已請假 >= 8 小時時 THEN 系統 SHALL 不允許再填寫正常工時（因為正常工時 + 請假時數已 >= 8 小時）
- WHEN 當天已請假 >= 8 小時且要填寫工作日加班類型時 THEN 系統 SHALL 允許填寫（因為正常工時 + 請假時數已滿足加班前置條件）
- WHEN 驗證失敗時 THEN 系統 SHALL 顯示超出多少小時的提示

### BR6.2.3: 工作日加班前置條件驗證

**User Story**: 作為員工，我需要系統驗證工作日加班前置條件，以便確保加班前已滿正常工時。

#### 驗收標準
- WHEN 員工填寫工作日加班類型時 THEN 系統 SHALL 驗證已滿 8 小時正常工時（正常工時 + 請假時數 >= 8）
- WHEN 正常工時 + 請假時數 < 8 小時時 THEN 系統 SHALL 提示錯誤並顯示尚缺多少小時正常工時
- WHEN 前端驗證時 THEN 系統 SHALL 只檢查當前表格中已填寫的記錄（不檢查已保存到資料庫的記錄）
- WHEN 後端驗證時 THEN 系統 SHALL 檢查當前提交的記錄和已保存到資料庫的記錄，確保總正常工時 + 請假時數 >= 8

### BR6.2.4: 加班類型前置條件驗證

**User Story**: 作為員工，我需要系統驗證加班類型的前置條件，以便確保加班類型填寫順序正確。

#### 驗收標準
- WHEN 員工填寫「平日OT後2h」時 THEN 系統 SHALL 驗證已先填寫「平日OT前2h」
- WHEN 員工填寫「休息日3-8h」時 THEN 系統 SHALL 驗證已先填寫「休息日前2h」
- WHEN 員工填寫「休息日9-12h」時 THEN 系統 SHALL 驗證已先填寫「休息日前2h」和「休息日3-8h」
- WHEN 員工填寫「國定9-10h」時 THEN 系統 SHALL 驗證已先填寫「國定8h內」
- WHEN 員工填寫「國定11-12h」時 THEN 系統 SHALL 驗證已先填寫「國定8h內」和「國定9-10h」
- WHEN 員工填寫「例假9-12h」時 THEN 系統 SHALL 驗證已先填寫「例假8h內」
- WHEN 前端驗證時 THEN 系統 SHALL 只檢查當前表格中已填寫的記錄
- WHEN 後端驗證時 THEN 系統 SHALL 檢查當前提交的記錄和已保存到資料庫的記錄，確保前置條件滿足
- WHEN 前置條件不滿足時 THEN 系統 SHALL 提示錯誤並顯示需要先填寫的工時類型

### BR6.2.5: 工時類型時數上限驗證

**User Story**: 作為員工，我需要系統驗證工時類型的時數上限，以便確保工時記錄符合規定。

#### 驗收標準
- WHEN 員工填寫「平日OT前2h」時 THEN 系統 SHALL 驗證時數 <= 2 小時
- WHEN 員工填寫「平日OT後2h」時 THEN 系統 SHALL 驗證時數 <= 2 小時
- WHEN 員工填寫「休息日前2h」時 THEN 系統 SHALL 驗證時數 <= 2 小時
- WHEN 員工填寫「休息日3-8h」時 THEN 系統 SHALL 驗證時數 <= 6 小時
- WHEN 員工填寫「休息日9-12h」時 THEN 系統 SHALL 驗證時數 <= 4 小時
- WHEN 員工填寫「國定8h內」時 THEN 系統 SHALL 驗證時數 <= 8 小時
- WHEN 員工填寫「國定9-10h」時 THEN 系統 SHALL 驗證時數 <= 2 小時
- WHEN 員工填寫「國定11-12h」時 THEN 系統 SHALL 驗證時數 <= 2 小時
- WHEN 員工填寫「例假8h內」時 THEN 系統 SHALL 驗證時數 <= 8 小時
- WHEN 員工填寫「例假9-12h」時 THEN 系統 SHALL 驗證時數 <= 4 小時
- WHEN 時數超過上限時 THEN 系統 SHALL 驗證同一天同一工時類型的累計時數不超過上限

### BR6.2.6: 每日總工時上限驗證

**User Story**: 作為員工，我需要系統驗證每日總工時上限，以便確保工時記錄符合勞基法規定。

#### 驗收標準
- WHEN 員工填寫工時時 THEN 系統 SHALL 驗證當日總工時（所有工時類型累加）<= 12 小時
- WHEN 當日總工時 > 12 小時時 THEN 系統 SHALL 提示錯誤並顯示超出多少小時
- WHEN 前端驗證時 THEN 系統 SHALL 檢查當前表格中已填寫的記錄（可選：通過 API 查詢已保存記錄）
- WHEN 後端驗證時 THEN 系統 SHALL 檢查當前提交的記錄和已保存到資料庫的記錄，確保總工時 <= 12 小時

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 驗證邏輯應該獨立封裝，易於維護和測試
- **Modular Design**: 不同類型的驗證規則應該分離，易於擴展
- **Reusability**: 驗證邏輯應該可以在前端和後端重用

### Performance
- 前端驗證響應時間 < 100ms
- 後端驗證響應時間 < 500ms

### Security
- 前端驗證和後端驗證雙重保護
- 後端驗證是最終防線，不能僅依賴前端驗證

### Reliability
- 驗證規則準確無誤
- 錯誤提示清晰明確
- 驗證邏輯一致（前端和後端）

### Usability
- 即時驗證提供即時反饋
- 錯誤提示清晰，指出具體問題
- 驗證不阻塞用戶輸入，只在提交時阻止

