# Requirements Document: BR4.1: 每月薪資結算

## Introduction

每月薪資結算功能提供統一的薪資查看、計算、明細查看和列印界面。本功能幫助管理員查看所有員工的薪資預覽、展開查看詳細計算明細，並支援列印個別員工的薪資單。

**User Story**: 作為會計師事務所的管理員，我需要查看和管理每月薪資結算，以便能夠查看所有員工的薪資、查看詳細計算明細，並列印個別員工的薪資單。

## Alignment with Product Vision

本功能支持薪資管理系統的核心目標：
- **提升薪資管理效率**：集中展示所有員工的薪資，提供統一的查看和管理界面
- **確保計算準確性**：自動計算所有薪資項目，確保計算準確
- **支援審計追蹤**：提供詳細計算明細，支援審計追蹤
- **提升工作效率**：支援列印功能，方便向員工提供薪資單

## Requirements

### BR4.1.1: 薪資結算月份選擇

**User Story**: 作為管理員，我需要選擇結算月份，以便查看特定月份的薪資結算。

#### 驗收標準
- WHEN 管理員打開薪資計算頁面時 THEN 系統 SHALL 預設顯示當前月份（YYYY-MM 格式）
- WHEN 管理員選擇結算月份時 THEN 系統 SHALL 自動觸發薪資計算並顯示所有員工的薪資預覽表格
- WHEN 管理員選擇結算月份時 THEN 系統 SHALL 支援選擇歷史月份和未來月份

### BR4.1.2: 薪資預覽表格展示

**User Story**: 作為管理員，我需要查看所有員工的薪資預覽表格，以便了解薪資整體狀況。

#### 驗收標準
- WHEN 管理員查看薪資預覽表格時 THEN 系統 SHALL 顯示以下資訊：
  - 員工姓名
  - 底薪
  - 加給（經常性加給）
  - 津貼（非經常性津貼）
  - 全勤狀態（是/否）
  - 全勤獎金
  - 加班費
  - 誤餐費
  - 交通補貼
  - 績效獎金
  - 年終獎金
  - 請假扣款
  - 應發金額
  - 固定扣款
  - 實發金額
- WHEN 管理員查看薪資預覽表格時 THEN 系統 SHALL 顯示所有員工的總計行（總應發金額、總實發金額、總扣款等）
- WHEN 管理員查看薪資預覽表格時 THEN 系統 SHALL 支援表格排序（按員工姓名、實發金額等）

### BR4.1.3: 詳細計算明細查看

**User Story**: 作為管理員，我需要查看詳細計算明細，以便了解每位員工的薪資計算過程。

#### 驗收標準
- WHEN 管理員展開員工的詳細計算明細時 THEN 系統 SHALL 顯示以下明細：
  - 加班費計算規則與明細（加班類型、時數、倍率、金額）
  - 時薪計算基礎與全勤（底薪、時薪、全勤狀態）
  - 交通補貼明細（外出記錄、距離、區間數、金額）
  - 請假扣款明細（請假類型、天數、扣款比例、金額）
  - 年終獎金明細（年終獎金金額、發放月份）
- WHEN 管理員展開詳細計算明細時 THEN 系統 SHALL 支援展開/收起切換
- WHEN 管理員查看詳細計算明細時 THEN 系統 SHALL 顯示所有計算步驟和公式

### BR4.1.4: 薪資單列印

**User Story**: 作為管理員，我需要列印個別員工的薪資單，以便向員工提供薪資單。

#### 驗收標準
- WHEN 管理員點擊列印按鈕時 THEN 系統 SHALL 列印該員工的薪資單
- WHEN 系統列印薪資單時 THEN 系統 SHALL 包含所有薪資項目和明細
- WHEN 系統列印薪資單時 THEN 系統 SHALL 使用適合列印的格式（PDF 或 HTML）
- WHEN 系統列印薪資單時 THEN 系統 SHALL 包含公司資訊和員工資訊

### BR4.1.5: 總計行顯示

**User Story**: 作為管理員，我需要查看所有員工的總計行，以便了解薪資總體狀況。

#### 驗收標準
- WHEN 管理員查看薪資預覽表格時 THEN 系統 SHALL 在表格底部顯示總計行
- WHEN 系統顯示總計行時 THEN 系統 SHALL 包含以下統計：
  - 總應發金額（所有員工的應發金額總和）
  - 總實發金額（所有員工的實發金額總和）
  - 總扣款（所有員工的扣款總和）
  - 各項目的總計（底薪總計、加給總計、津貼總計、全勤獎金總計、加班費總計、誤餐費總計、交通補貼總計、績效獎金總計、年終獎金總計、請假扣款總計、固定扣款總計）

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 每個文件應該有單一、明確的職責
- **Modular Design**: 組件、工具和服務應該隔離且可重用
- **Dependency Management**: 最小化模組之間的相互依賴
- **Clear Interfaces**: 定義組件和層之間的清晰契約

### Performance
- API 響應時間 < 2 秒（薪資計算）
- 頁面載入時間 < 3 秒
- 列印響應時間 < 3 秒
- 支援大量員工的薪資計算（至少 100 名員工）

### Security
- 只有管理員可以查看薪資計算頁面
- 使用參數化查詢防止 SQL 注入
- 前端輸入驗證和後端驗證

### Reliability
- 薪資計算結果準確
- 明細數據完整
- 列印功能穩定

### Usability
- 界面簡潔直觀
- 表格易於閱讀
- 明細展開/收起操作流暢
- 列印格式清晰易讀

