# Implementation Log: Task 8

**Summary:** 對齊 BR1.1 客戶列表管理：合併客戶編號和統編欄位為統一編號並格式化顯示，新增 contact_person_1 資料庫欄位，實現管理員專屬刪除按鈕

**Timestamp:** 2025-11-15T17:49:41.416Z
**Log ID:** 851fbaa5-4b16-4135-80f0-8201a10d693e

---

## Statistics

- **Lines Added:** +45
- **Lines Removed:** -12
- **Files Changed:** 4
- **Net Change:** 33

## Files Modified
- src/components/clients/ClientListTable.vue
- src/views/clients/ClientsList.vue
- backend/src/handlers/clients/client-crud.js

## Files Created
- backend/migrations/0034_add_client_contact_person.sql

---

## Artifacts

### API Endpoints

#### GET /api/clients
- **Purpose:** 獲取客戶列表，包含 contact_person_1 欄位
- **Location:** backend/src/handlers/clients/client-crud.js:12-189
- **Request Format:** Query params: page, perPage, q (search), tag_id, no_cache
- **Response Format:** { list: Client[], meta: { page, perPage, total, hasNext } }

### Components

#### ClientListTable
- **Type:** Vue
- **Purpose:** 客戶列表表格組件，顯示統一編號（格式化）、聯絡人、刪除按鈕（管理員專屬）
- **Location:** src/components/clients/ClientListTable.vue
- **Props:** { clients, loading, pagination, selectedClientIds, isAdmin }
- **Exports:** ClientListTable (default)

#### ClientsList
- **Type:** Vue
- **Purpose:** 客戶列表頁面，傳遞 isAdmin 狀態給 ClientListTable
- **Location:** src/views/clients/ClientsList.vue
- **Props:** None (uses Vue Router)
- **Exports:** ClientsList (default)

### Functions

#### formatTaxRegistrationNumber
- **Purpose:** 格式化統一編號顯示：企業客戶（10碼且以00開頭）去掉前綴00顯示8碼，個人客戶顯示完整10碼
- **Location:** src/components/clients/ClientListTable.vue:237-246
- **Signature:** (taxId: string | number) => string
- **Exported:** No

### Integrations

#### Integration
- **Description:** ClientsList 從 useAuthStore 獲取 isAdmin 狀態，傳遞給 ClientListTable 控制刪除按鈕顯示
- **Frontend Component:** ClientsList
- **Backend Endpoint:** N/A (uses Pinia store)
- **Data Flow:** useAuthStore.isAdmin → ClientsList.isAdmin (computed) → ClientListTable.isAdmin (prop) → 條件渲染刪除按鈕

#### Integration
- **Description:** ClientListTable 調用 API 獲取客戶列表，後端 handleClientList 返回包含 contact_person_1 的數據
- **Frontend Component:** ClientListTable
- **Backend Endpoint:** GET /api/clients
- **Data Flow:** Component mount → API call → Backend query (includes contact_person_1) → Display in table

