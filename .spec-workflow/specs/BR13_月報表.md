# BR13: 月報表（Monthly Reports）

**定位/目的**: 提供月份層級的經營數據視圖，包含營收、薪資、客戶獲利、員工績效等，用於月度營運檢視與管理決策。

**路由**
- 月報表：`/reports/monthly`

---

## 指標範圍
- 月營收：依收據金額（含一次性與定期）統計
- 月薪資：該月結算薪資總額
- 月客戶獲利：客戶營收 − 客戶成本（工時成本 + 其他成本）
- 月員工績效：工時統計、任務完成情況、服務執行情況

---

## 功能需求
- 篩選維度：年度、月份、客戶、服務、員工
- 視覺化呈現：圖表 + 匯總表格（趨勢、對比、Top N）
- 深入鑽取：點擊指標下鑽到客戶/服務/員工細節或明細清單
- 對帳提示：與應計、收據、任務完成度差異提醒
- 權限控制：管理員可看全域；員工僅看與自身相關資料
- 報表快取：見「報表快取」段落
- 匯出：不提供（按規格移除）

---

## 驗收標準
- WHEN 使用者切換月份/年度 THEN 系統 SHALL 於 500ms 內返回快取或新鮮數據
- WHEN 使用者點擊圖表項目 THEN 系統 SHALL 顯示對應的明細彈層或導向明細頁
- WHEN 權限不足 THEN 系統 SHALL 僅顯示允許範圍的數據

---

## 業務規則
- 客戶獲利 = 營收 − 成本（工時成本 + 其他成本）
- 員工績效包含工時統計、任務完成率、服務完成情況等
- 數據以月為粒度，與年報關聯但獨立計算

---

## 報表快取（Monthly）
- 快取目的：降低重複計算開銷，加速查詢
- 快取鍵建議：`monthly:{year}:{month}:{filtersHash}`
- 更新策略：
  - 定時預先計算（每日/每小時）與手動刷新
  - 相關來源資料（收據、薪資、工時、成本）變更時標記失效
- 數據來源：
  - 收據、薪資、工時、成本、任務完成度、收費計劃/應計（只作差異提示，不重算）


