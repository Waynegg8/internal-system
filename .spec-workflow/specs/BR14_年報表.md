# BR14: 年報表（Yearly Reports）

**定位/目的**: 提供年度層級的經營數據全貌，統計各月累計與年對年趨勢，支持年度策略制定與績效考核。

**路由**
- 年報表：`/reports/yearly`

---

## 指標範圍
- 年營收：12 個月營收累計與月度分布
- 年薪資：12 個月薪資累計與月度分布
- 年客戶獲利：全年客戶營收 − 全年客戶成本
- 年員工績效：全年工時統計、任務完成情況、服務執行情況

---

## 功能需求
- 篩選維度：年度、客戶、服務、員工
- 視覺化呈現：年度趨勢圖、月度分布熱力圖、Top N 客戶/服務/員工
- 鑽取：點擊年度指標下鑽至月度（導向 `BR13 月報表` 帶參數）
- 對帳提示：應計與現金基礎差異、任務/收據差異
- 權限控制：管理員全域、員工僅自身相關
- 報表快取：見「報表快取」段落
- 匯出：不提供（按規格移除）

---

## 驗收標準
- WHEN 使用者切換年度/篩選 THEN 系統 SHALL 於可接受時間內（<=700ms）返回快取或新鮮數據
- WHEN 使用者點擊年度指標 THEN 系統 SHALL 導向對應月份之 `BR13` 報表並保留篩選
- WHEN 權限不足 THEN 系統 SHALL 僅顯示允許範圍的數據

---

## 業務規則
- 指標以年為粒度；月度細節統一由 `BR13 月報表` 呈現
- 客戶獲利與員工績效的計算口徑與月報一致，但按年彙總

---

## 報表快取（Yearly）
- 快取目的：降低重算成本，加速切換年度/篩選時的體驗
- 快取鍵建議：`yearly:{year}:{filtersHash}`
- 更新策略：
  - 定時預先計算（每日）與手動刷新
  - 來源資料（收據、薪資、工時、成本）重大變更時標記失效
- 數據來源：
  - 以月報快取為基礎聚合，必要時直接彙總底層資料

