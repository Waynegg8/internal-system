# BR12: 附件管理（Attachments）

**定位/目的**: 為全系統提供一致的附件上傳、預覽、下載與權限控管能力（任務、SOP、資源、收據等共用）。

**路由**
- 附件無獨立頁；以通用附件組件嵌入各功能頁（任務、SOP、收據等）

---

## 功能需求
- 上傳：拖放/選檔，多檔並行上傳、進度顯示、大小與類型驗證
- 預覽：圖片/PDF 在線預覽；其他檔案提供下載
- 權限：繼承所屬實體（任務/客戶/資源）權限；支援到期連結與一次性連結
- 儲存：Cloudflare R2；路徑與 metadata（擁有者、來源模組、關聯鍵）
- 審計：上傳/下載/刪除均寫入審計日誌

---

## 驗收標準
- WHEN 上傳附件 THEN 系統 SHALL 驗證檔案大小與類型並顯示進度
- WHEN 預覽附件 THEN 系統 SHALL 支援圖片/PDF 原生預覽
- WHEN 下載附件 THEN 系統 SHALL 僅允許具備讀取權限之使用者

---

## 業務規則
- 敏感檔案需啟用到期連結與防盜鏈設定
- 刪除為軟刪除（保留 metadata 與稽核追蹤）；實體刪除走異步清理


