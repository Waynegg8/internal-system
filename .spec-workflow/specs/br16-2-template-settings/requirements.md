# Requirements Document: BR16.2: 任務模板設定

## Introduction

任務模板設定功能提供系統層級的任務模板管理，包括新增、編輯、查看、刪除任務模板，以及設定模板關聯的服務類型和客戶。本功能幫助所有用戶統一管理任務模板，為任務自動生成提供基礎配置。

**User Story**: 作為系統用戶，我需要管理任務模板，以便能夠統一管理任務模板，為任務自動生成提供基礎配置。

## Alignment with Product Vision

本功能支持系統設定的核心目標：
- **統一模板管理**：集中管理所有任務模板，確保模板資料的一致性
- **支援任務自動生成**：為任務自動生成提供基礎模板配置
- **靈活的模板套用**：支援客戶專屬模板和通用模板的套用策略

## Requirements

### BR16.2.1: 任務模板列表展示

**User Story**: 作為系統用戶，我需要查看任務模板列表，以便了解所有任務模板的狀況。

#### 驗收標準
- WHEN 用戶打開任務模板設定頁面時 THEN 系統 SHALL 顯示所有任務模板（所有用戶可訪問）
- WHEN 用戶查看任務模板列表時 THEN 系統 SHALL 顯示以下資訊：
  - 模板名稱（`template_name`）
  - 服務名稱（關聯的服務名稱）
  - 客戶名稱（關聯的客戶名稱，如為通用模板則顯示「通用模板」）
  - 操作（查看、編輯、刪除）

### BR16.2.2: 查看任務模板

**User Story**: 作為系統用戶，我需要查看任務模板詳情，以便了解模板的完整配置。

#### 驗收標準
- WHEN 用戶點擊「查看」按鈕時 THEN 系統 SHALL 以只讀模式顯示模板資訊
- WHEN 用戶查看任務模板時 THEN 系統 SHALL 顯示以下資訊：
  - 模板基本信息：模板名稱、服務名稱、客戶名稱
  - 服務層級 SOP（如果服務有關聯 SOP）
  - 任務配置（按階段分組顯示）
- WHEN 用戶查看任務配置時 THEN 系統 SHALL 按階段順序分組顯示任務
- WHEN 用戶在查看模式下點擊「編輯模板」時 THEN 系統 SHALL 切換到編輯模式

### BR16.2.3: 新增任務模板

**User Story**: 作為系統用戶，我需要新增任務模板，以便擴展系統支援的任務模板。

#### 驗收標準
- WHEN 用戶點擊「新增模板」按鈕時 THEN 系統 SHALL 顯示任務模板編輯表單
- WHEN 用戶填寫任務模板表單時 THEN 系統 SHALL 要求填寫以下欄位：
  - 模板名稱（必填）
  - 服務類型（可選）：可選擇已存在的服務
  - 客戶（可選）：可選擇已存在的客戶，如不選擇則為通用模板
  - 任務配置：可設定多個任務階段，每個階段可設定多個任務
- WHEN 用戶提交新增表單時 THEN 系統 SHALL 驗證必填欄位
- WHEN 用戶成功新增任務模板時 THEN 系統 SHALL 刷新模板列表並顯示成功提示

### BR16.2.4: 編輯任務模板

**User Story**: 作為系統用戶，我需要編輯任務模板，以便更新模板配置。

#### 驗收標準
- WHEN 用戶點擊「編輯」按鈕時 THEN 系統 SHALL 顯示任務模板編輯表單，並預填充現有資料
- WHEN 用戶編輯任務模板時 THEN 系統 SHALL 允許修改所有欄位
- WHEN 用戶提交編輯表單時 THEN 系統 SHALL 驗證必填欄位
- WHEN 用戶成功更新任務模板時 THEN 系統 SHALL 刷新模板列表並顯示成功提示

### BR16.2.5: 刪除任務模板

**User Story**: 作為系統用戶，我需要刪除任務模板，以便移除不再使用的模板。

#### 驗收標準
- WHEN 用戶點擊「刪除」按鈕時 THEN 系統 SHALL 顯示確認對話框
- WHEN 用戶確認刪除時 THEN 系統 SHALL 從資料庫真正刪除該任務模板（硬刪除，非軟刪除）
- WHEN 用戶刪除任務模板時 THEN 系統 SHALL 不檢查關聯資料（不檢查是否有任務使用此模板）
- WHEN 用戶成功刪除任務模板時 THEN 系統 SHALL 刷新模板列表並顯示成功提示

### BR16.2.6: 模板套用策略

**User Story**: 作為系統，我需要按照模板套用策略選擇合適的模板，以便為客戶服務自動生成任務。

#### 驗收標準
- WHEN 系統需要為客戶服務套用模板時 THEN 系統 SHALL 優先選擇客戶專屬模板（關聯該客戶的模板）
- WHEN 系統找不到客戶專屬模板時 THEN 系統 SHALL 選擇通用模板（未關聯客戶的模板）
- WHEN 系統套用模板後 THEN 系統 SHALL 允許修改任務配置，且修改不回寫模板

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 每個文件應該有單一、明確的職責
- **Modular Design**: 組件、工具和服務應該隔離且可重用
- **Dependency Management**: 最小化模組之間的相互依賴
- **Clear Interfaces**: 定義組件和層之間的清晰契約

### Performance
- API 響應時間 < 500ms
- 頁面載入時間 < 3 秒
- 模板列表載入時間 < 2 秒

### Security
- 所有用戶可訪問任務模板設定頁面（用戶管理功能除外）
- 使用參數化查詢防止 SQL 注入
- 前端輸入驗證和後端驗證

### Reliability
- 模板列表載入穩定
- 新增/編輯/刪除操作可靠
- 模板查看和編輯模式切換流暢

### Usability
- 界面簡潔直觀
- 查看模式和編輯模式清晰區分
- 任務配置按階段分組顯示，易於理解


