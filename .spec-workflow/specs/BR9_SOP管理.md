# BR9: SOP 管理（Standard Operating Procedures）

**定位/目的**: 建立、維護並關聯 SOP，支援服務層級與任務層級 SOP，供任務生成時自動複製與查閱。

**路由**
- SOP 列表/編輯：`/knowledge/sop`
- SOP 詳情：`/knowledge/sop/:id`

---

## 功能需求
- SOP 建立/編輯：標題、層級（service/task）、服務類型、內容（富文本）、版本、狀態（啟用/停用）
- 關聯：可關聯到服務類型、特定客戶或保持通用（未綁定客戶）
- 套用時機：任務生成時複製任務層級 SOP；選擇服務時自動綁定服務層級 SOP
- 搜尋/篩選：依層級、服務類型、客戶、關鍵字
- 版本管理：歷史版本瀏覽與回滾

---

## 驗收標準
- WHEN 建立 SOP THEN 系統 SHALL 支援富文本編輯並保存版本
- WHEN 任務生成 THEN 系統 SHALL 自動複製關聯的任務層級 SOP
- WHEN 選擇服務 THEN 系統 SHALL 自動綁定服務層級 SOP（若服務類型已設定）
- WHEN 搜尋 SOP THEN 系統 SHALL 依層級/服務類型/客戶/關鍵字正確篩選

---

## 業務規則
- 服務層級 SOP 不出現在任務層級 SOP 選項中（反之亦然）
- 客戶專屬 SOP 僅在該客戶範圍內可見
- 版本回滾僅影響後續套用，不影響已複製到任務的內容


