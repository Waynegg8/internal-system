# BR4: 薪資管理（Payroll）

**定位/目的**: 依公司薪資規則自動計算與核發薪資，考量工時、加班、請假、獎金/扣款等，並支援期間結算、對帳與調整。

**路由**
- 結算面板：`/finance/payroll`
- 期間明細：`/finance/payroll/:period`（例：`2025-01`、`2025-Q1`）

---

## 功能需求
- 期間結算：選擇結算期間（年月/區間），彙整人員薪資項目並計算總額
- 薪資項目計算：底薪、經常/非經常津貼、獎金、年終、績效、加班費、誤餐、交通、固定扣款、請假扣款
- 請假/加班整合：自工時、請假、外出、補休池讀取並自動計算
- 補休到期轉換：到期未使用之補休自動轉為加班費
- 參數設定連動：扣款比例、誤餐門檻、交通補貼區間與金額
- 調整與鎖定：允許人工微調、歷史版本保存、結算鎖定/解鎖
- 匯出與對帳：匯出核薪名單，與工時與請假紀錄差異提示
 - 打卡整合：讀取打卡紀錄進行出缺勤校對與異常提示（遲到、早退、缺卡）

---

## 驗收標準
- WHEN 系統計算薪資時 THEN 系統 SHALL 自動計算底薪、加班費、獎金、扣款等所有項目
- WHEN 員工請假時 THEN 系統 SHALL 在薪資計算時自動扣款
- WHEN 員工加班時 THEN 系統 SHALL 自動計算加班費或產生補休
- WHEN 管理員查看結算頁 THEN 系統 SHALL 顯示每位員工各薪資項目與總額，並支持人工調整與鎖定
 - WHEN 匯入打卡紀錄 THEN 系統 SHALL 依設定規則標記遲到/早退/缺卡並影響出缺勤統計

---

## 業務規則
- 病假扣款比例可設定（如 50% 或 100%）
- 事假通常全額扣款，可透過參數改動
- 生理假前 3 天不扣款（年度累計），超過 3 天部分扣款
- 平日加班達一定時數發放誤餐費；外出依距離計算交通補貼（區間制）
- 加班產生補休；補休到期自動轉加班費；補休使用採 FIFO 扣減
- 全勤獎金僅在當期無病假/事假時發放

---

## 打卡紀錄（併入薪資）

**資料來源與處理**
- 來源：門禁/第三方打卡匯入或人工補登
- 匯入格式：日期、上班/下班時間、地點/設備、備註
- 清洗規則：跨日補正、遺漏補卡流程、異常標記

**與薪資互動**
- 出缺勤統計作為核薪依據：缺卡/遲到/早退可影響獎金或扣款
- 例外處理：管理員核准的補卡/更正視為正常出勤


