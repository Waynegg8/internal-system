# Implementation Log: Task 6.3

**Summary:** 優化通知 API 調用函數，包括改進 fetchUnreadCount 函數的錯誤處理和查詢參數

**Timestamp:** 2025-11-20T18:07:56.461Z
**Log ID:** da6b4d8e-7e34-493f-9447-e3f99b80f8c8

---

## Statistics

- **Lines Added:** +5
- **Lines Removed:** -3
- **Files Changed:** 2
- **Net Change:** 2

## Files Modified
- src/api/notifications.js
- .spec-workflow/specs/br2-6-task-notifications/tasks.md

## Files Created
_No files created_

---

## Artifacts

### Functions

#### fetchNotifications
- **Purpose:** 獲取通知列表，支持分頁、類型篩選和已讀狀態篩選
- **Location:** src/api/notifications.js:16
- **Signature:** async (params = {}) => Promise<Object>
- **Exported:** Yes

#### fetchUnreadCount
- **Purpose:** 獲取未讀通知數量，通過請求通知列表來獲取後端返回的 unreadCount 字段
- **Location:** src/api/notifications.js:24
- **Signature:** async () => Promise<number>
- **Exported:** Yes

#### markAsRead
- **Purpose:** 標記通知為已讀（單個或批量），接受通知 ID 或 ID 數組
- **Location:** src/api/notifications.js:34
- **Signature:** async (notificationIds: number|Array<number>) => Promise<Object>
- **Exported:** Yes

#### markAsReadById
- **Purpose:** 標記單個通知為已讀（通過路由參數）
- **Location:** src/api/notifications.js:46
- **Signature:** async (notificationId: number) => Promise<Object>
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** NotificationsList 和 DashboardAlertsPanel 組件使用 useNotificationsApi 來獲取通知列表、未讀數量和標記已讀
- **Frontend Component:** NotificationsList, DashboardAlertsPanel
- **Backend Endpoint:** GET /api/v2/notifications, PUT /api/v2/notifications/read, PUT /api/v2/notifications/:id/read
- **Data Flow:** 組件調用 API 函數 → request 發送 HTTP 請求 → 後端處理 → 返回數據 → extractApiData 提取數據 → 組件更新狀態

