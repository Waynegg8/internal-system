# Implementation Log: Task 11

**Summary:** 在年度報表主頁面添加統一刷新按鈕。更新所有年度報表 API 函數和 Store actions 支援 refresh 參數。實現 handleRefreshAllReports 函數，並行調用所有年度報表 API 並傳遞 refresh=1 參數，顯示加載狀態和成功/錯誤消息。

**Timestamp:** 2025-11-19T12:57:34.642Z
**Log ID:** df56bf9f-8eb8-4623-a6e1-fc1d27d977b9

---

## Statistics

- **Lines Added:** +60
- **Lines Removed:** -4
- **Files Changed:** 3
- **Net Change:** 56

## Files Modified
- src/api/reports.js
- src/stores/reports.js
- src/views/reports/AnnualReports.vue

## Files Created
_No files created_

---

## Artifacts

### Components

#### AnnualReports
- **Type:** Vue 3
- **Purpose:** 年度報表主頁面，包含統一刷新按鈕
- **Location:** src/views/reports/AnnualReports.vue
- **Props:** None
- **Exports:** AnnualReports (default)

### Functions

#### handleRefreshAllReports
- **Purpose:** 刷新所有年度報表，強制重新計算並忽略快取
- **Location:** src/views/reports/AnnualReports.vue:312
- **Signature:** async function handleRefreshAllReports()
- **Exported:** No

#### fetchAnnualRevenue
- **Purpose:** 載入年度收款報表，支援 refresh 參數
- **Location:** src/api/reports.js:164
- **Signature:** async function fetchAnnualRevenue(year, options = {})
- **Exported:** Yes

#### fetchAnnualPayroll
- **Purpose:** 載入年度薪資報表，支援 refresh 參數
- **Location:** src/api/reports.js:196
- **Signature:** async function fetchAnnualPayroll(year, options = {})
- **Exported:** Yes

#### fetchAnnualEmployeePerformance
- **Purpose:** 載入年度員工產值報表，支援 refresh 參數
- **Location:** src/api/reports.js:228
- **Signature:** async function fetchAnnualEmployeePerformance(year, options = {})
- **Exported:** Yes

#### fetchAnnualClientProfitability
- **Purpose:** 載入年度客戶毛利報表，支援 refresh 參數
- **Location:** src/api/reports.js:260
- **Signature:** async function fetchAnnualClientProfitability(year, options = {})
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** 刷新按鈕並行調用所有年度報表 API，傳遞 refresh=1 參數，強制後端重新計算並忽略快取
- **Frontend Component:** AnnualReports
- **Backend Endpoint:** GET /api/v2/reports/annual/{reportType}?year={year}&refresh=1
- **Data Flow:** 用戶點擊刷新按鈕 → 並行調用所有年度報表 API（refresh=1） → 後端強制重新計算 → 更新 Store 數據 → 顯示成功/錯誤消息

