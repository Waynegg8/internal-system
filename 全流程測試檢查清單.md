# 完整系統全流程測試檢查清單

## 一、系統設定模組（需先完成，作為前置條件）

### 1. 系統設定 - 服務設定（SettingsServices）
- [ ] 創建服務項目
  - 服務名稱
  - 服務描述
  - SOP關聯（可選）

### 2. 系統設定 - 模板設定（SettingsTemplates）
- [ ] 創建任務模板（統一模板或客戶專屬模板）
  - 模板名稱
  - 關聯服務（可選）
  - 關聯客戶（客戶專屬模板）
  - 任務配置（至少1個任務）
    - 任務名稱
    - 任務描述
    - 預估工時
    - 階段順序
    - SOP關聯
    - 生成時間規則
    - 到期規則
    - 執行頻率
    - 執行月份
    - 備註

### 3. 系統設定 - 公司設定（SettingsCompany）
- [ ] 設置公司資料1
  - 公司中文名稱（必填）
  - 公司英文名稱（可選）
  - 統一編號（必填）
  - 公司地址第一行（必填）
  - 公司地址第二行（可選）
  - 聯絡電話（必填）
  - 銀行名稱（必填）
  - 銀行代號（必填）
  - 銀行帳號（必填）
- [ ] 設置公司資料2（同上）

### 4. 系統設定 - 假期設定（SettingsHolidays）
- [ ] 新增假日（至少3個）
  - 日期
  - 假日名稱
  - 假日類型

### 5. 系統設定 - 用戶管理（SettingsUsers）
- [ ] 創建用戶（至少3個）
  - 用戶名（必填）
  - 密碼（必填）
  - 姓名（必填）
  - Email（可選）
  - 性別（可選）
  - 入職日期（可選）
  - 電話（可選）
  - 地址（可選）
  - 緊急聯絡人姓名（可選）
  - 緊急聯絡人電話（可選）

### 6. 系統設定 - 自動化規則（SettingsAutomation）
- [ ] 查看自動生成任務的組件（只讀，實際設定在客戶服務中）

---

## 二、客戶管理模組

### 1. 客戶基本信息
- [ ] 公司名稱（必填）
- [ ] 統一編號（必填，8碼）
- [ ] 公司聯絡人1
- [ ] 公司聯絡人2
- [ ] 負責人員（必填）
- [ ] 聯絡電話
- [ ] Email
- [ ] 主要聯絡方式
- [ ] LINE ID
- [ ] 公司負責人
- [ ] 公司地址
- [ ] 資本額
- [ ] 股東持股資訊（至少2個）
  - 股東姓名（必填）
  - 持股類型（普通股/特別股/其他）
  - 持股比例（%）
  - 持股數（股）
  - 持股金額（新台幣元）
  - 持股比例合計需為100%
- [ ] 董監事資訊（至少3個）
  - 姓名（必填）
  - 職務（董事/監事/董事長/副董事長/常務董事/獨立董事/常務監事/其他）
  - 任期開始日期
  - 任期結束日期
  - 是否為現任
- [ ] 客戶備註
- [ ] 收款備註
- [ ] 標籤管理（可選）
- [ ] 協作人員（可選）

### 2. 客戶服務（ClientServices）
- [ ] 添加定期服務（至少1個）
  - 服務項目選擇
  - 服務開始日期
  - 服務結束日期（可選）
  - 執行月份（JSON數組，如[1,2,3,4,5,6,7,8,9,10,11,12]）
  - 服務狀態（active/inactive）
  - 服務類型（recurring）
  - 是否用於自動生成（use_for_auto_generate）
- [ ] 添加一次性服務（至少1個）
  - 服務項目選擇
  - 服務開始日期
  - 服務結束日期
  - 服務狀態（active/inactive）
  - 服務類型（one-time）
  - 是否用於自動生成（use_for_auto_generate）

### 3. 任務配置（ClientServiceTaskConfigs）
- [ ] 為每個服務配置任務（至少1個任務）
  - 任務名稱（必填）
  - 任務描述
  - 負責人員（assignee_user_id）
  - 預估工時（estimated_hours）
  - 階段順序（stage_order）
  - 備註（notes）
  - 生成時間規則（generation_time_rule）
  - 生成時間參數（generation_time_params，JSON）
  - 到期規則（due_rule：end_of_month/specific_day/next_month_day/days_after_start）
  - 到期值（due_value）
  - 到期天數（days_due）
  - 提前天數（advance_days）
  - 是否固定期限（is_fixed_deadline）
  - 固定期限日期（fixed_deadline，當is_fixed_deadline=true時）
  - 執行頻率（execution_frequency：monthly/bi-monthly/quarterly/semi-annual/annual/custom）
  - 執行月份（execution_months，JSON數組）
  - SOP關聯（TaskConfigSOPs）
    - SOP ID
    - 排序順序

### 4. 收費設定（BillingPlans）
- [ ] 創建定期服務收費計劃
  - 客戶ID
  - 收費年度
  - 收費類型（recurring）
  - 年度總計
  - 付款期限（天數）
  - 備註
  - 關聯服務（BillingPlanServices）
  - 月份明細（BillingPlanMonths，至少3個月）
    - 月份（1-12）
    - 金額
    - 付款期限（天數，可選）
- [ ] 創建一次性服務收費計劃
  - 客戶ID
  - 收費年度
  - 收費類型（one-time）
  - 年度總計
  - 付款期限（天數）
  - 收費日期（billing_date）
  - 描述（description）
  - 備註
  - 關聯服務（BillingPlanServices，只關聯一個一次性服務）

---

## 三、任務管理模組

### 1. 任務自動生成（通過cron job或手動觸發）
- [ ] 驗證任務已從TaskGenerationTemplates生成到TaskGenerationQueue
- [ ] 驗證任務已從TaskGenerationQueue生成到ActiveTasks
- [ ] 驗證任務包含所有配置字段（任務名稱、描述、負責人、預估工時、階段、SOP等）

### 2. 任務階段（ActiveTaskStages）
- [ ] 驗證任務階段已生成
- [ ] 驗證階段狀態（pending/in_progress/completed）

### 3. 任務SOP關聯（ActiveTaskSOPs）
- [ ] 驗證任務SOP關聯已生成（繼承自TaskConfigSOPs或TaskGenerationTemplateSOPs）

### 4. 任務依賴關係
- [ ] 驗證任務依賴（prerequisite_task_id）
- [ ] 驗證可開始日期（can_start_date）
- [ ] 驗證固定期限任務（is_fixed_deadline, fixed_deadline）

---

## 四、工時管理模組

### 1. 工時記錄（Timesheets）
- [ ] 創建工時記錄（至少5筆，涵蓋不同日期類型）
  - 用戶ID（必填）
  - 客戶ID（可選）
  - 服務ID（可選）
  - 任務ID（可選，通過task_name關聯）
  - 工作日期（必填）
  - 工時類型（work_type：1-11，根據date_type選擇）
  - 工時數（hours，必填，0.5小時增量，最大12小時）
  - 日期類型（date_type：workday/restday/weekly_restday/national_holiday/makeup_workday）
  - 備註（可選）
  - **業務規則驗證**：
    - 每日工時上限12小時
    - 0.5小時增量
    - 工時類型必須符合日期類型
    - 加班類型前置條件（如type 3需要type 2）
    - 請假日期不能填工時

---

## 五、假期管理模組

### 1. 請假記錄（LeaveRequests）
- [ ] 創建請假記錄（至少2筆，不同類型）
  - 用戶ID（必填）
  - 請假類型（leave_type：annual/sick/personal/compensatory/maternity/paternity/marriage/funeral/other）
  - 開始日期（必填）
  - 結束日期（必填）
  - 單位（unit：hours/days）
  - 數量（amount，必填）
  - 開始時間（start_time，當unit=hours時）
  - 結束時間（end_time，當unit=hours時）
  - 狀態（status：approved，直接設為已核准，無需審批）
  - 提交時間（submitted_at）

### 2. 請假餘額（LeaveBalances）
- [ ] 驗證請假餘額已更新（當請假記錄創建時自動更新）

---

## 六、外出管理模組

### 1. 外出記錄（BusinessTrips）
- [ ] 創建外出記錄（至少1筆）
  - 用戶ID（必填）
  - 客戶ID（可選）
  - 外出日期（必填）
  - 外出類型（trip_type：client_visit/meeting/other）
  - 出發地點
  - 目的地
  - 交通方式（transport_method）
  - 交通費用（transport_cost）
  - 備註

---

## 七、收據管理模組

### 1. 收據（Receipts）
- [ ] 創建收據（至少1筆，關聯已完成任務）
  - 收據編號（receipt_id，系統自動生成或手動輸入）
  - 客戶ID（必填）
  - 收據日期（必填）
  - 到期日期（必填）
  - 總金額（total_amount，必填）
  - 狀態（status：unpaid/partial/paid）
  - 收據類型（receipt_type：normal/adjustment/refund）
  - 客戶服務ID（client_service_id）
  - 收費月份（billing_month）
  - 服務開始月份（service_start_month）
  - 服務結束月份（service_end_month）
  - 備註
  - 創建人（created_by）
  - 是否自動生成（is_auto_generated）
  - 已付金額（paid_amount，初始為0）

### 2. 收據項目（ReceiptItems）
- [ ] 為收據添加項目（至少1個）
  - 收據ID（必填）
  - 項目名稱（item_name）
  - 數量（quantity）
  - 單價（unit_price）
  - 小計（subtotal，需等於quantity * unit_price）
  - 備註
  - **驗證**：Receipts.total_amount = SUM(ReceiptItems.subtotal)

### 3. 收據服務類型（ReceiptServiceTypes）
- [ ] 關聯收據與服務
  - 收據ID
  - 服務ID

### 4. 付款記錄（Payments）
- [ ] 為收據添加付款記錄（至少1筆）
  - 收據ID（必填）
  - 付款日期（必填）
  - 付款金額（payment_amount，必填）
  - 付款方式（payment_method：cash/bank_transfer/check/other）
  - 參考號碼（reference_number）
  - 備註
  - 創建人（created_by）
  - **驗證**：更新Receipts.paid_amount和status（partial/paid）

### 5. 收據編輯歷史（ReceiptEditHistory）
- [ ] 驗證收據編輯歷史已記錄（當total_amount或status變更時）

---

## 八、薪資管理模組

### 1. 薪資項目類型（SalaryItemTypes）- PayrollItems頁面
- [ ] 創建薪資項目類型（至少3個，不同類別）
  - 項目代碼（item_code，系統自動生成）
  - 項目名稱（item_name，必填）
  - 類別（category：allowance/bonus/deduction）
  - 是否經常性給與（is_regular_payment，影響時薪計算）
  - 是否固定（is_fixed）
  - 描述（description）
  - 顯示順序（display_order）

### 2. 員工薪資項目（EmployeeSalaryItems）- PayrollEmp頁面
- [ ] 為每個用戶設置底薪（base_salary）
- [ ] 為每個用戶設置薪資項目（至少2個）
  - 用戶ID（必填）
  - 項目類型ID（item_type_id，必填）
  - 金額（amount_cents，以分為單位，必填）
  - 生效日期（effective_date，必填，YYYY-MM-DD）
  - 過期日期（expiry_date，可選，NULL表示永久有效）
  - 是否啟用（is_active）
  - 備註（notes）
  - 發放週期（payment_period：monthly/once/yearly）

### 3. 薪資系統設定（PayrollSettings）- PayrollSettings頁面
- [ ] 設置薪資計算參數
  - 各種薪資計算相關的系統參數
  - 交通補貼設定
  - 誤餐費設定
  - 其他薪資計算規則

---

## 九、成本管理模組

### 1. 成本項目類型（OverheadCostTypes）- CostItems頁面
- [ ] 創建成本項目類型（至少3個）
  - 成本代碼（cost_code，系統自動生成）
  - 成本名稱（cost_name，必填）
  - 類別（category：fixed/variable）
  - 分攤方式（allocation_method：per_employee/per_hour/per_revenue）
  - 描述（description）
  - 顯示順序（display_order）

### 2. 月度管理費用（MonthlyOverheadCosts）- CostItems頁面
- [ ] 創建月度成本記錄（至少3個月）
  - 成本類型ID（cost_type_id，必填）
  - 年份（year，必填）
  - 月份（month，必填，1-12）
  - 金額（amount，必填）
  - 備註（notes）
  - 記錄人（recorded_by）
  - **唯一約束**：同一成本類型、同一年份、同一月份只能有一筆記錄

---

## 十、知識庫模組

### 1. SOP管理（SOPDocuments）- KnowledgeSOP頁面
- [ ] 創建SOP文檔（至少2個）
  - SOP名稱（sop_name，必填）
  - SOP描述（description）
  - SOP內容（content）
  - 範圍（scope：global/service/task）
  - 關聯服務（ClientServiceSOPs，當scope=service時）
  - 關聯任務配置（TaskConfigSOPs，當scope=task時）
  - 版本號（version）
  - 是否啟用（is_active）

### 2. FAQ管理（InternalFAQ）- KnowledgeFAQ頁面
- [ ] 創建FAQ（至少2個）
  - 問題（question，必填）
  - 答案（answer，必填）
  - 分類（category）
  - 標籤（tags，JSON數組）
  - 範圍（scope：global/client）
  - 關聯客戶（client_id，當scope=client時）
  - 創建人（created_by）

### 3. 資源管理（InternalDocuments）- KnowledgeResources頁面
- [ ] 上傳資源文檔（至少1個）
  - 標題（title，必填）
  - 描述（description）
  - 文件名（file_name）
  - 文件URL（file_url）
  - 文件大小（file_size）
  - 文件類型（file_type）
  - 分類（category）
  - 標籤（tags，JSON數組）
  - 上傳人（uploaded_by）
  - 關聯客戶（client_id，可選）
  - 關聯任務（related_task_id，可選）

### 4. 附件管理（Attachments）- KnowledgeAttachments頁面
- [ ] 上傳附件（至少1個，關聯不同實體）
  - 附件名稱（attachment_name，必填）
  - 文件URL（file_url，必填）
  - 文件大小（file_size）
  - 文件類型（file_type）
  - 關聯類型（entity_type：client/receipt/sop/task）
  - 關聯ID（entity_id）
  - 上傳人（uploaded_by）

---

## 十一、驗證邏輯關聯和業務規則

### 1. 任務相關邏輯
- [ ] 驗證任務依賴關係（prerequisite_task_id → can_start_date）
- [ ] 驗證固定期限任務衝突（is_fixed_deadline → TaskDueDateAdjustments, DashboardAlerts）
- [ ] 驗證任務狀態更新（TaskStatusUpdates）
- [ ] 驗證任務事件日誌（TaskEventLogs）
- [ ] 驗證任務通知歷史（TaskNotificationHistory）

### 2. 收費相關邏輯
- [ ] 驗證收費提醒生成（ActiveTasks完成 → BillingReminders，需檢查所有任務完成）
- [ ] 驗證收據金額一致性（Receipts.total_amount = SUM(ReceiptItems.subtotal)）
- [ ] 驗證付款金額一致性（Receipts.paid_amount = SUM(Payments.payment_amount)）
- [ ] 驗證收據狀態自動更新（unpaid → partial → paid）
- [ ] 驗證ServiceBillingSchedule已生成（當BillingPlans創建時）

### 3. 薪資相關邏輯
- [ ] 驗證薪資重算觸發（Timesheets/LeaveRequests/BusinessTrips變更 → PayrollRecalcQueue, PayrollCache.needs_recalc）
- [ ] 驗證工時與薪資關聯（Timesheets → Payroll計算）

### 4. 請假相關邏輯
- [ ] 驗證請假直接核准（LeaveRequests.status = 'approved'，無需審批）
- [ ] 驗證請假餘額更新（LeaveRequests → LeaveBalances）
- [ ] 驗證請假與工時互斥（請假日期不能填工時）

### 5. 成本相關邏輯
- [ ] 驗證成本分攤（MonthlyOverheadCosts → 按分攤方式計算）

### 6. 任務實際工時
- [ ] 驗證ActiveTasks.actual_hours = SUM(關聯Timesheets.hours)

### 7. 儀表板提醒
- [ ] 驗證DashboardAlerts生成（任務完成 → receipt_pending提醒）

### 8. 歷史記錄
- [ ] 驗證ServiceChangeHistory（ClientServices狀態變更）
- [ ] 驗證TaskConfigChangeLog（任務配置變更）
- [ ] 驗證TaskGenerationHistory（任務生成歷史）
- [ ] 驗證CronJobExecutions（定時任務執行記錄）
- [ ] 驗證DashboardSummary（每日摘要）

---

## 十二、報表模組（驗證數據完整性）

### 1. 月度報表
- [ ] 驗證月度收款報表數據
- [ ] 驗證月度薪資報表數據
- [ ] 驗證月度員工產值分析
- [ ] 驗證月度客戶毛利分析

### 2. 年度報表
- [ ] 驗證年度收款報表數據
- [ ] 驗證年度薪資報表數據
- [ ] 驗證年度員工產值分析
- [ ] 驗證年度客戶毛利分析

---

## 測試執行順序建議

1. **系統設定**（前置條件）
   - 服務設定 → 模板設定 → 公司設定 → 假期設定 → 用戶管理

2. **客戶管理**
   - 基本信息 → 客戶服務 → 任務配置 → 收費設定

3. **任務管理**
   - 驗證任務自動生成 → 驗證任務階段 → 驗證任務SOP → 驗證任務依賴

4. **工時、假期、外出**
   - 工時記錄 → 假期記錄 → 外出記錄

5. **收據管理**
   - 收據 → 收據項目 → 付款記錄

6. **薪資管理**
   - 薪資項目類型 → 員工薪資項目 → 薪資系統設定

7. **成本管理**
   - 成本項目類型 → 月度成本記錄

8. **知識庫**
   - SOP → FAQ → 資源 → 附件

9. **驗證邏輯關聯**
   - 逐一驗證所有業務邏輯鏈條

10. **報表驗證**
    - 驗證報表數據完整性

